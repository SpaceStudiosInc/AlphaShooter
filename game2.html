<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drone Strike</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{background:#222;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:'Courier New',monospace;color:#fff;overflow:hidden;}
    #gameContainer{position:relative;max-width:100vw;max-height:100vh;}
    canvas{border:3px solid #444;background:#87CEEB;display:block;max-width:100%;max-height:100vh;}
    #ui{position:absolute;top:10px;left:10px;font-size:18px;color:#222;text-shadow:1px 1px 2px #fff;z-index:10;}
    #startScreen,#gameOverScreen{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,0.9);z-index:20;}
    .hidden{display:none !important;}
    h1{font-size:48px;color:#ffcc00;margin-bottom:20px;text-shadow:0 0 15px #ff9900;}
    .btn{padding:15px 40px;font-size:20px;background:#ffcc00;border:none;color:#000;cursor:pointer;font-weight:bold;margin:10px;transition:all .3s;touch-action:manipulation;}
    .btn:hover{background:#ffeb3b;transform:scale(1.1);}
    .instructions{margin-top:30px;text-align:center;color:#ddd;font-size:14px;}
    .instructions div{margin:5px 0;}
    #mobileControls{position:absolute;bottom:20px;left:0;right:0;display:none;justify-content:space-between;padding:0 20px;z-index:15;}
    #mobileControls.active{display:flex;}
    .controlGroup{display:flex;flex-direction:column;gap:10px;}
    .dpad{display:grid;grid-template-columns:60px 60px 60px;grid-template-rows:60px 60px 60px;gap:5px;}
    .controlBtn{background:rgba(255,255,255,.3);border:2px solid #fff;color:#fff;font-size:24px;font-weight:bold;border-radius:10px;touch-action:manipulation;user-select:none;}
    .controlBtn:active{background:rgba(255,255,255,.6);}
    .dpad .controlBtn:nth-child(1){grid-column:2;grid-row:1;}
    .dpad .controlBtn:nth-child(2){grid-column:1;grid-row:2;}
    .dpad .controlBtn:nth-child(3){grid-column:3;grid-row:2;}
    .dpad .controlBtn:nth-child(4){grid-column:2;grid-row:3;}
    .fireButtons{display:flex;flex-direction:column;gap:10px;}
    .fireBtn{width:90px;height:90px;background:rgba(255,0,0,.4);border:3px solid #f00;color:#fff;font-size:16px;font-weight:bold;border-radius:50%;touch-action:manipulation;user-select:none;display:flex;align-items:center;justify-content:center;text-align:center;}
    .fireBtn:active{background:rgba(255,0,0,.8);}
    @media(max-width:768px){h1{font-size:32px;}.instructions{font-size:12px;}}
</style>
</head>
<body>
<div id="gameContainer">
    <canvas id="gameCanvas" width="600" height="800"></canvas>
    <div id="ui">
        <div>SCORE: <span id="score">0</span></div>
        <div>LIVES: <span id="lives">3</span></div>
    </div>
    <div id="mobileControls">
        <div class="controlGroup">
            <div class="dpad">
                <button class="controlBtn" data-key="left">←</button>
                <button class="controlBtn" data-key="up">↑</button>
                <button class="controlBtn" data-key="down">↓</button>
                <button class="controlBtn" data-key="right">→</button>
            </div>
        </div>
        <div class="fireButtons">
            <button class="fireBtn" data-key="bomb">DROP<br>BOMB</button>
        </div>
    </div>
    <div id="startScreen">
        <h1>DRONE STRIKE</h1>
        <button class="btn" onclick="startGame()">START MISSION</button>
        <div class="instructions">
            <div>← → ↑ ↓ or WASD – MOVE DRONE</div>
            <div>SPACE or X – DROP BOMB</div>
            <div>Target enemies scrolling from top. 1 second delayed strike!</div>
        </div>
    </div>
    <div id="gameOverScreen" class="hidden">
        <h1>MISSION FAILED</h1>
        <div style="font-size:32px;margin:20px;">FINAL SCORE: <span id="finalScore">0</span></div>
        <button class="btn" onclick="startGame()">RETRY</button>
    </div>
</div>
<script>
/* ---------- GLOBALS ---------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let gameState = 'start';
let score = 0, lives = 3;
const player = {x: 300, y: 120, width: 44, height: 44, speed: 6};
let keys = {}, strikes = [], groundEnemies = [], explosions = [], clouds = [];
let bombCooldown = 0;
let missCount = 0;
const MAX_MISSES = 8;
const GROUND_Y = canvas.height - 120;
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
if (isMobile) document.getElementById('mobileControls').classList.add('active');

/* ---------- CLOUDS ---------- */
for(let i=0; i<30; i++) clouds.push({
    x: Math.random()*canvas.width,
    y: Math.random()*200 - 50,
    size: Math.random()*40 + 20,
    speed: Math.random()*0.5 + 0.2
});

/* ---------- INPUT ---------- */
document.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
    if ((e.key===' '||e.key.toLowerCase()==='x') && gameState==='playing' && bombCooldown<=0) dropStrike();
});
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

function touchStart(e){
    e.preventDefault();
    const k = this.dataset.key;
    if(k==='bomb') dropStrike();
    else keys[k] = true;
}
function touchEnd(e){
    e.preventDefault();
    const k = this.dataset.key;
    if(k!=='bomb') keys[k] = false;
}
document.querySelectorAll('.controlBtn,.fireBtn').forEach(b => {
    b.addEventListener('touchstart', touchStart);
    b.addEventListener('touchend', touchEnd);
});

/* ---------- GAME FLOW ---------- */
function startGame(){
    gameState = 'playing';
    score = 0; lives = 3; missCount = 0;
    player.x = canvas.width/2; 
    strikes = []; groundEnemies = []; explosions = [];
    bombCooldown = 0;
    document.getElementById('startScreen').classList.add('hidden');
    document.getElementById('gameOverScreen').classList.add('hidden');
    updateUI();
    requestAnimationFrame(gameLoop);
}

function gameOver(){
    gameState = 'gameover';
    document.getElementById('finalScore').textContent = score;
    document.getElementById('gameOverScreen').classList.remove('hidden');
}

function updateUI(){
    document.getElementById('score').textContent = score;
    document.getElementById('lives').textContent = lives;
}

/* ---------- PLAYER ---------- */
function updatePlayer(){
    if ((keys['arrowleft']||keys['a']||keys['left']) && player.x > 25) player.x -= player.speed;
    if ((keys['arrowright']||keys['d']||keys['right']) && player.x < canvas.width - 25) player.x += player.speed;
    if ((keys['arrowup']||keys['w']||keys['up']) && player.y > 60) player.y -= player.speed;
    if ((keys['arrowdown']||keys['s']||keys['down']) && player.y < 220) player.y += player.speed;
    if (bombCooldown > 0) bombCooldown--;
}

/* ---------- STRIKE (1 second delay, then instant hit at exact spot) ---------- */
function dropStrike(){
    strikes.push({
        x: player.x,
        life: 60,  // ~1 second at 60fps
        maxLife: 60
    });
    bombCooldown = 20;  // cooldown between strikes
}

function updateStrikes(){
    const newStrikes = [];
    for(const s of strikes){
        s.life--;
        if(s.life > 0){
            newStrikes.push(s);
        } else {
            // STRIKE! Check hits at exact position
            createExplosion(s.x, GROUND_Y, 60);
            let hit = false;
            for(let j = groundEnemies.length - 1; j >= 0; j--){
                const e = groundEnemies[j];
                if(e.destroyed) continue;
                const dist = Math.hypot(s.x - e.x, GROUND_Y - e.y);
                if(dist < 45){
                    e.hp--;
                    if(e.hp <= 0){
                        e.destroyed = true;
                        score += e.type === 'tank' ? 300 : e.type === 'building' ? 200 : 150;
                        updateUI();
                    }
                    hit = true;
                    break;
                }
            }
            if(!hit){
                missCount++;
                if(missCount >= MAX_MISSES){
                    lives--;
                    missCount = 0;
                    updateUI();
                    if(lives <= 0) gameOver();
                }
            }
        }
    }
    strikes = newStrikes;
}

/* ---------- ENEMIES (scroll DOWN from top to GROUND) ---------- */
function spawnGroundEnemy(){
    const types = ['soldier', 'building', 'tank'];
    const type = types[Math.floor(Math.random() * types.length)];
    groundEnemies.push({
        x: Math.random() * (canvas.width - 80) + 40,
        y: -100,  // spawn at top
        type: type,
        hp: type === 'soldier' ? 1 : type === 'building' ? 4 : 2,
        destroyed: false,
        speed: 2.2 + Math.random() * 0.5
    });
}

function updateGroundEnemies(){
    const newE = [];
    for(const e of groundEnemies){
        e.y += e.speed;  // move DOWN toward ground
        if(e.y < GROUND_Y + 50) newE.push(e);  // keep until past ground
    }
    groundEnemies = newE;
    
    // spawn new enemies
    if(Math.random() < 0.018) spawnGroundEnemy();
}

/* ---------- EXPLOSIONS ---------- */
function createExplosion(x, y, size = 50){
    explosions.push({x, y, size, life: 30, maxLife: 30});
}

function updateExplosions(){
    const newE = [];
    for(const e of explosions){
        e.life--;
        if(e.life > 0) newE.push(e);
    }
    explosions = newE;
}

/* ---------- CLOUDS ---------- */
function updateClouds(){
    for(const c of clouds){
        c.x += c.speed;
        if(c.x > canvas.width + 100) c.x = -100;
    }
}

/* ---------- DRAWING ---------- */
function drawBackground(){
    // Sky gradient
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, '#87CEEB');
    grad.addColorStop(0.6, '#98D8C8');
    grad.addColorStop(1, '#228B22');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Ground texture
    ctx.fillStyle = '#8B7355';
    ctx.fillRect(0, GROUND_Y - 20, canvas.width, 120);
    ctx.fillStyle = '#654321';
    for(let i = 0; i < canvas.width; i += 15) {
        ctx.fillRect(i, GROUND_Y - 15, 8, 10);
    }
}

function drawClouds(){
    ctx.fillStyle = '#fff';
    ctx.globalAlpha = 0.8;
    for(const c of clouds){
        ctx.save();
        ctx.translate(c.x, c.y);
        ctx.beginPath();
        ctx.arc(0, 0, c.size * 0.4, 0, Math.PI * 2);
        ctx.arc(c.size * 0.3, 0, c.size * 0.5, 0, Math.PI * 2);
        ctx.arc(-c.size * 0.3, 0, c.size * 0.5, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
    ctx.globalAlpha = 1;
}

function drawPlayer(){
    ctx.save();
    ctx.translate(player.x, player.y);
    
    // Drone body
    ctx.fillStyle = '#4a4a4a';
    ctx.fillRect(-22, -22, 44, 44);
    ctx.fillStyle = '#666';
    ctx.fillRect(-12, -30, 24, 12);
    
    // Propellers
    ctx.strokeStyle = '#222';
    ctx.lineWidth = 3;
    for(let i = 0; i < 4; i++){
        const px = [-16, 16, -16, 16][i];
        const py = [-12, -12, 12, 12][i];
        ctx.beginPath();
        ctx.moveTo(px - 12, py);
        ctx.lineTo(px + 12, py);
        ctx.stroke();
    }
    
    // Camera
    ctx.fillStyle = '#ff4444';
    ctx.beginPath();
    ctx.arc(0, 0, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
}

function drawStrikes(){
    for(const s of strikes){
        const alpha = s.life / s.maxLife;
        ctx.save();
        ctx.globalAlpha = alpha * 0.8;
        ctx.translate(s.x, player.y + 20);
        ctx.scale(1 + (1 - alpha) * 0.5, 1 + (1 - alpha) * 0.5);
        
        // Bomb falling
        ctx.fillStyle = '#444';
        ctx.fillRect(-4, -8, 8, 16);
        ctx.fillStyle = '#ff8800';
        ctx.fillRect(-3, 6, 6, 6);
        ctx.restore();
    }
}

function drawGroundEnemies(){
    for(const e of groundEnemies){
        if(e.destroyed) continue;
        
        const progress = (e.y + 100) / (GROUND_Y + 100);  // 0 at top, 1 at ground
        const scale = 0.4 + progress * 0.8;  // grow as they approach
        
        ctx.save();
        ctx.translate(e.x, e.y);
        ctx.scale(scale, scale);
        
        if(e.type === 'soldier'){
            // Soldier
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(-8, -25, 16, 25);  // body
            ctx.fillStyle = '#228B22';
            ctx.fillRect(-5, -32, 10, 8);   // helmet
            ctx.fillStyle = '#000';
            ctx.fillRect(-12, -5, 4, 8);    // rifle
        } else if(e.type === 'building'){
            // Building
            ctx.fillStyle = '#666';
            ctx.fillRect(-25, -35, 50, 35);
            ctx.fillStyle = '#444';
            ctx.fillRect(-20, -30, 40, 25);
            ctx.fillStyle = '#ff4444';
            ctx.fillRect(-8, -42, 16, 12);  // roof detail
        } else { // tank
            // Tank
            ctx.fillStyle = '#4a4a4a';
            ctx.fillRect(-22, -18, 44, 18);
            ctx.fillStyle = '#333';
            ctx.fillRect(-15, -25, 30, 12); // turret
            ctx.fillStyle = '#ff0000';
            ctx.beginPath();
            ctx.arc(0, -20, 8, 0, Math.PI * 2);
            ctx.fill(); // cannon
        }
        ctx.restore();
    }
}

function drawExplosions(){
    for(const e of explosions){
        const alpha = e.life / e.maxLife;
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.translate(e.x, e.y);
        const size = e.size * (1 + (1 - alpha) * 0.6);
        
        // Fire
        ctx.fillStyle = '#ffaa00';
        ctx.beginPath();
        ctx.arc(0, 0, size * 0.6, 0, Math.PI * 2);
        ctx.fill();
        
        // Blast
        ctx.fillStyle = '#ff4444';
        ctx.beginPath();
        ctx.arc(0, 0, size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
    ctx.globalAlpha = 1;
}

/* ---------- MAIN LOOP ---------- */
function gameLoop(){
    if(gameState !== 'playing') return;
    
    // Clear
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Update
    drawBackground();
    updateClouds();
    drawClouds();
    
    updatePlayer();
    updateStrikes();
    updateGroundEnemies();
    updateExplosions();
    
    // Draw
    drawGroundEnemies();
    drawStrikes();
    drawExplosions();
    drawPlayer();
    
    requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
