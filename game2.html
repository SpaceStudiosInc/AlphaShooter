<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drone Strike</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {background:#222;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:'Courier New',monospace;color:#fff;overflow:hidden;}
    #gameContainer {position:relative;max-width:100vw;max-height:100vh;}
    canvas {border:3px solid #444;background:#87CEEB;display:block;max-width:100%;max-height:100vh;}
    #ui {position:absolute;top:10px;left:10px;font-size:18px;color:#222;text-shadow:1px 1px 2px #fff;z-index:10;}
    #startScreen,#gameOverScreen {position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,0.9);z-index:20;}
    .hidden {display:none !important;}
    h1 {font-size:48px;color:#ffcc00;margin-bottom:20px;text-shadow:0 0 15px #ff9900;}
    .btn {padding:15px 40px;font-size:20px;background:#ffcc00;border:none;color:#000;cursor:pointer;font-weight:bold;margin:10px;transition:all .3s;touch-action:manipulation;}
    .btn:hover {background:#ffeb3b;transform:scale(1.1);}
    .instructions {margin-top:30px;text-align:center;color:#ddd;font-size:14px;}
    .instructions div {margin:5px 0;}
    #mobileControls {position:absolute;bottom:20px;left:0;right:0;display:none;justify-content:space-between;padding:0 20px;z-index:15;}
    #mobileControls.active {display:flex;}
    .controlGroup {display:flex;flex-direction:column;gap:10px;}
    .dpad {display:grid;grid-template-columns:60px 60px 60px;grid-template-rows:60px 60px 60px;gap:5px;}
    .controlBtn {background:rgba(255,255,255,.3);border:2px solid #fff;color:#fff;font-size:24px;font-weight:bold;border-radius:10px;touch-action:manipulation;user-select:none;}
    .controlBtn:active {background:rgba(255,255,255,.6);}
    .dpad .controlBtn:nth-child(1){grid-column:2;grid-row:1;}
    .dpad .controlBtn:nth-child(2){grid-column:1;grid-row:2;}
    .dpad .controlBtn:nth-child(3){grid-column:3;grid-row:2;}
    .dpad .controlBtn:nth-child(4){grid-column:2;grid-row:3;}
    .fireButtons {display:flex;flex-direction:column;gap:10px;}
    .fireBtn {width:90px;height:90px;background:rgba(255,0,0,.4);border:3px solid #f00;color:#fff;font-size:16px;font-weight:bold;border-radius:50%;touch-action:manipulation;user-select:none;display:flex;align-items:center;justify-content:center;text-align:center;}
    .fireBtn:active {background:rgba(255,0,0,.8);}
    @media (max-width:768px){
        h1{font-size:32px;}
        .instructions{font-size:12px;}
    }
</style>
</head>
<body>
<div id="gameContainer">
    <canvas id="gameCanvas" width="600" height="800"></canvas>
    <div id="ui">
        <div>SCORE: <span id="score">0</span></div>
        <div>LIVES: <span id="lives">3</span></div>
    </div>
    <div id="mobileControls">
        <div class="controlGroup">
            <div class="dpad">
                <button class="controlBtn" data-key="up">↑</button>
                <button class="controlBtn" data-key="left">←</button>
                <button class="controlBtn" data-key="right">→</button>
                <button class="controlBtn" data-key="down">↓</button>
            </div>
        </div>
        <div class="fireButtons">
            <button class="fireBtn" data-key="bomb">DROP<br>BOMB</button>
        </div>
    </div>
    <div id="startScreen">
        <h1>DRONE STRIKE</h1>
        <button class="btn" onclick="startGame()">START MISSION</button>
        <div class="instructions">
            <div>← → or A D – MOVE DRONE</div>
            <div>SPACE or X – DROP BOMB</div>
            <div>Destroy ground targets. Avoid missing too many.</div>
        </div>
    </div>
    <div id="gameOverScreen" class="hidden">
        <h1>MISSION FAILED</h1>
        <div style="font-size:32px;margin:20px;">FINAL SCORE: <span id="finalScore">0</span></div>
        <button class="btn" onclick="startGame()">RETRY</button>
    </div>
</div>
<script>
/* ---------- GLOBALS ---------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let gameState = 'start';
let score = 0, lives = 3;
const player = {x:300, y:150, width:40, height:20, speed:6};
let keys = {}, bombs = [], groundEnemies = [], explosions = [], clouds = [];
let bombCooldown = 0;
let targetReticle = null;
let missCount = 0;
const MAX_MISSES = 5;
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
if (isMobile) document.getElementById('mobileControls').classList.add('active');

/* ---------- CLOUDS ---------- */
for(let i=0;i<30;i++) clouds.push({
    x: Math.random() * canvas.width,
    y: Math.random() * 200,
    size: Math.random() * 60 + 40,
    speed: Math.random() * 0.3 + 0.1
});

/* ---------- INPUT ---------- */
document.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
    if ((e.key === ' ' || e.key.toLowerCase() === 'x') && gameState === 'playing' && bombCooldown <= 0) dropBomb();
});
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

function handleTouchStart(e){
    e.preventDefault();
    const k = this.dataset.key;
    if(k === 'bomb') dropBomb();
    else keys[k] = true;
}
function handleTouchEnd(e){
    e.preventDefault();
    const k = this.dataset.key;
    if(k !== 'bomb') keys[k] = false;
}
document.querySelectorAll('.controlBtn,.fireBtn').forEach(b => {
    b.addEventListener('touchstart', handleTouchStart);
    b.addEventListener('touchend', handleTouchEnd);
});

/* ---------- GAME FLOW ---------- */
function startGame(){
    gameState = 'playing'; score = 0; lives = 3; missCount = 0;
    player.x = 300;
    bombs = []; groundEnemies = []; explosions = []; targetReticle = null;
    bombCooldown = 0;
    document.getElementById('startScreen').classList.add('hidden');
    document.getElementById('gameOverScreen').classList.add('hidden');
    updateUI();
    requestAnimationFrame(gameLoop);
}

function gameOver(){
    gameState = 'gameover';
    document.getElementById('finalScore').textContent = score;
    document.getElementById('gameOverScreen').classList.remove('hidden');
}

function updateUI(){
    document.getElementById('score').textContent = score;
    document.getElementById('lives').textContent = lives;
}

/* ---------- PLAYER (DRONE) ---------- */
function updatePlayer(){
    if ((keys['arrowleft'] || keys['a'] || keys['left']) && player.x > 30) player.x -= player.speed;
    if ((keys['arrowright'] || keys['d'] || keys['right']) && player.x < canvas.width - 30) player.x += player.speed;
    if ((keys['arrowup'] || keys['w'] || keys['up']) && player.y > 80) player.y -= player.speed;
    if ((keys['arrowdown'] || keys['s'] || keys['down']) && player.y < 250) player.y += player.speed;
    if (bombCooldown > 0) bombCooldown--;
}

/* ---------- BOMB DROP (WITH GRAVITY) ---------- */
function dropBomb(){
    bombs.push({
        x: player.x,
        y: player.y + 10,
        vx: 0,
        vy: 0,
        width: 8, height: 14,
        gravity: 0.4,
        life: 300
    });
    bombCooldown = 15;
}

function updateBombs(){
    const newB = [];
    for(const b of bombs){
        b.vy += b.gravity;
        b.x += b.vx;
        b.y += b.vy;
        b.life--;

        let hit = false;
        for(let j = groundEnemies.length - 1; j >= 0; j--){
            const e = groundEnemies[j];
            if(e.destroyed) continue;
            if (Math.abs(b.x - e.x) < 25 && Math.abs(b.y - e.y) < 25){
                e.hp--;
                if(e.hp <= 0){
                    e.destroyed = true;
                    createExplosion(e.x, e.y, 60);
                    score += e.type === 'bunker' ? 200 : e.type === 'turret' ? 150 : 300;
                    updateUI();
                }
                hit = true;
                break;
            }
        }

        if(!hit && b.y < canvas.height + 50 && b.life > 0) newB.push(b);
        else if(!hit && b.y > canvas.height - 50){
            missCount++;
            if(missCount >= MAX_MISSES){
                lives--;
                missCount = 0;
                updateUI();
                if(lives <= 0) gameOver();
            }
        }
    }
    bombs = newB;
}

/* ---------- TARGET RETICLE (PREDICTED IMPACT) ---------- */
function updateTargetReticle(){
    if(bombCooldown > 0 || bombs.length > 0) {
        targetReticle = null;
        return;
    }
    let x = player.x, y = player.y + 10, vy = 0;
    const steps = 60;
    for(let i = 0; i < steps; i++){
        vy += 0.4;
        y += vy;
        if(y > canvas.height) break;
    }
    let closest = null, minDist = Infinity;
    for(const e of groundEnemies){
        if(e.destroyed) continue;
        const d = Math.hypot(e.x - x, e.y - y);
        if(d < minDist){ minDist = d; closest = e; }
    }
    targetReticle = closest ? {x: closest.x, y: closest.y, predX: x, predY: y} : {x, y, predX: x, predY: y};
}

/* ---------- GROUND ENEMIES ---------- */
function spawnGroundEnemy(){
    const types = ['bunker', 'turret', 'depot'];
    const type = types[Math.floor(Math.random() * types.length)];
    groundEnemies.push({
        x: Math.random() * (canvas.width - 80) + 40,
        y: -50,
        width: type === 'bunker' ? 50 : type === 'turret' ? 40 : 45,
        height: 40,
        type,
        hp: type === 'bunker' ? 3 : type === 'turret' ? 2 : 1,
        destroyed: false
    });
}

function updateGroundEnemies(){
    const newE = [];
    for(const e of groundEnemies){
        e.y += 1.8;
        if(e.y < canvas.height + 100) newE.push(e);
    }
    groundEnemies = newE;
}

/* ---------- EXPLOSIONS ---------- */
function createExplosion(x, y, size = 50){
    explosions.push({x, y, size, life: 25, maxLife: 25});
}

function updateExplosions(){
    const newE = [];
    for(const e of explosions){
        e.life--;
        if(e.life > 0) newE.push(e);
    }
    explosions = newE;
}

/* ---------- CLOUDS ---------- */
function updateClouds(){
    for(const c of clouds){
        c.x += c.speed;
        if(c.x > canvas.width + 100) c.x = -100;
    }
}

/* ---------- DRAWING ---------- */
function drawBackground(){
    // Sky
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, '#87CEEB');
    grad.addColorStop(1, '#98D8C8');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Ground
    ctx.fillStyle = '#8B7355';
    ctx.fillRect(0, canvas.height - 100, canvas.width, 100);

    // Grass
    ctx.fillStyle = '#228B22';
    ctx.fillRect(0, canvas.height - 100, canvas.width, 20);
}

function drawClouds(){
    ctx.fillStyle = '#fff';
    for(const c of clouds){
        ctx.globalAlpha = 0.8;
        ctx.beginPath();
        ctx.arc(c.x, c.y, c.size * 0.4, 0, Math.PI*2);
        ctx.arc(c.x + c.size * 0.3, c.y, c.size * 0.5, 0, Math.PI*2);
        ctx.arc(c.x - c.size * 0.3, c.y, c.size * 0.5, 0, Math.PI*2);
        ctx.fill();
    }
    ctx.globalAlpha = 1;
}

function drawPlayer(){
    ctx.save();
    ctx.translate(player.x, player.y);
    // Drone body
    ctx.fillStyle = '#444';
    ctx.fillRect(-20, -8, 40, 16);
    ctx.fillRect(-10, -12, 20, 8);
    // Propellers
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 2;
    for(let i = 0; i < 4; i++){
        const px = [-15, 15, -15, 15][i];
        const py = [-5, -5, 5, 5][i];
        ctx.beginPath();
        ctx.moveTo(px - 8, py);
        ctx.lineTo(px + 8, py);
        ctx.stroke();
    }
    // Camera
    ctx.fillStyle = '#f00';
    ctx.beginPath();
    ctx.arc(0, 0, 3, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
}

function drawBombs(){
    for(const b of bombs){
        ctx.save();
        ctx.translate(b.x, b.y);
        ctx.rotate(Math.atan2(b.vy, b.vx) + Math.PI/2);
        ctx.fillStyle = '#333';
        ctx.fillRect(-4, -7, 8, 14);
        ctx.fillStyle = '#f80';
        ctx.fillRect(-3, 4, 6, 6);
        ctx.restore();
    }
}

function drawGroundEnemies(){
    for(const e of groundEnemies){
        if(e.destroyed) continue;
        ctx.save();
        ctx.translate(e.x, e.y);
        if(e.type === 'bunker'){
            ctx.fillStyle = '#555';
            ctx.fillRect(-25, -15, 50, 30);
            ctx.fillStyle = '#333';
            ctx.fillRect(-20, -10, 40, 20);
            ctx.fillStyle = '#f00';
            ctx.fillRect(-5, -20, 10, 10);
        } else if(e.type === 'turret'){
            ctx.fillStyle = '#666';
            ctx.fillRect(-15, -10, 30, 20);
            ctx.fillStyle = '#444';
            ctx.fillRect(-5, -20, 10, 15);
            ctx.fillStyle = '#f00';
            ctx.beginPath();
            ctx.arc(0, -15, 6, 0, Math.PI*2);
            ctx.fill();
        } else { // depot
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(-22, -18, 44, 36);
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(-18, -14, 12, 12);
            ctx.fillRect(-2, -14, 12, 12);
            ctx.fillRect(10, -14, 12, 12);
        }
        ctx.restore();
    }
}

function drawExplosions(){
    for(const e of explosions){
        const a = e.life / e.maxLife;
        const s = e.size * (1 + (1 - a) * 0.8);
        ctx.save();
        ctx.globalAlpha = a;
        ctx.translate(e.x, e.y);
        ctx.fillStyle = '#ff9500';
        ctx.beginPath();
        ctx.arc(0, 0, s * 0.5, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = '#ff0000';
        ctx.beginPath();
        ctx.arc(0, 0, s * 0.8, 0, Math.PI*2);
        ctx.fill();
        ctx.restore();
    }
    ctx.globalAlpha = 1;
}

function drawTargetReticle(){
    if(!targetReticle) return;
    const { predX, predY } = targetReticle;
    ctx.strokeStyle = '#ff0000';
    ctx.lineWidth = 2;
    ctx.setLineDash([8, 8]);
    ctx.beginPath();
    ctx.arc(predX, predY, 30, 0, Math.PI*2);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.strokeStyle = '#ffff00';
    ctx.beginPath();
    ctx.moveTo(predX - 35, predY);
    ctx.lineTo(predX - 20, predY);
    ctx.moveTo(predX + 20, predY);
    ctx.lineTo(predX + 35, predY);
    ctx.moveTo(predX, predY - 35);
    ctx.lineTo(predX, predY - 20);
    ctx.moveTo(predX, predY + 20);
    ctx.lineTo(predX, predY + 35);
    ctx.stroke();
}

/* ---------- MAIN LOOP ---------- */
let enemySpawnTimer = 0;
function gameLoop(){
    if(gameState !== 'playing') return;

    drawBackground();
    updateClouds();
    drawClouds();
    updatePlayer();
    updateBombs();
    updateGroundEnemies();
    updateExplosions();
    updateTargetReticle();

    // Spawn enemies
    if(++enemySpawnTimer > 90){
        spawnGroundEnemy();
        enemySpawnTimer = 0;
    }

    drawGroundEnemies();
    drawTargetReticle();
    drawBombs();
    drawExplosions();
    drawPlayer();

    requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
