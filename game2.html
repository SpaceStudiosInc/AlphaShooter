<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drone Strike</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{background:#222;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:'Courier New',monospace;color:#fff;overflow:hidden;}
    #gameContainer{position:relative;max-width:100vw;max-height:100vh;}
    canvas{border:3px solid #444;background:#87CEEB;display:block;max-width:100%;max-height:100vh;}
    #ui{position:absolute;top:10px;left:10px;font-size:18px;color:#222;text-shadow:1px 1px 2px #fff;z-index:10;}
    #startScreen,#gameOverScreen{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,0.9);z-index:20;}
    .hidden{display:none !important;}
    h1{font-size:48px;color:#ffcc00;margin-bottom:20px;text-shadow:0 0 15px #ff9900;}
    .btn{padding:15px 40px;font-size:20px;background:#ffcc00;border:none;color:#000;cursor:pointer;font-weight:bold;margin:10px;transition:all .3s;touch-action:manipulation;}
    .btn:hover{background:#ffeb3b;transform:scale(1.1);}
    .instructions{margin-top:30px;text-align:center;color:#ddd;font-size:14px;}
    .instructions div{margin:5px 0;}
    #mobileControls{position:absolute;bottom:20px;left:0;right:0;display:none;justify-content:space-between;padding:0 20px;z-index:15;}
    #mobileControls.active{display:flex;}
    .controlGroup{display:flex;flex-direction:column;gap:10px;}
    .dpad{display:grid;grid-template-columns:60px 60px 60px;grid-template-rows:60px 60px 60px;gap:5px;}
    .controlBtn{background:rgba(255,255,255,.3);border:2px solid #fff;color:#fff;font-size:24px;font-weight:bold;border-radius:10px;touch-action:manipulation;user-select:none;}
    .controlBtn:active{background:rgba(255,255,255,.6);}
    .dpad .controlBtn:nth-child(1){grid-column:2;grid-row:1;}
    .dpad .controlBtn:nth-child(2){grid-column:1;grid-row:2;}
    .dpad .controlBtn:nth-child(3){grid-column:3;grid-row:2;}
    .dpad .controlBtn:nth-child(4){grid-column:2;grid-row:3;}
    .fireButtons{display:flex;flex-direction:column;gap:10px;}
    .fireBtn{width:90px;height:90px;background:rgba(255,0,0,.4);border:3px solid #f00;color:#fff;font-size:16px;font-weight:bold;border-radius:50%;touch-action:manipulation;user-select:none;display:flex;align-items:center;justify-content:center;text-align:center;}
    .fireBtn:active{background:rgba(255,0,0,.8);}
    @media(max-width:768px){h1{font-size:32px;}.instructions{font-size:12px;}}
</style>
</head>
<body>
<div id="gameContainer">
    <canvas id="gameCanvas" width="600" height="800"></canvas>
    <div id="ui">
        <div>SCORE: <span id="score">0</span></div>
        <div>LIVES: <span id="lives">3</span></div>
    </div>
    <div id="mobileControls">
        <div class="controlGroup">
            <div class="dpad">
                <button class="controlBtn" data-key="up">↑</button>
                <button class="controlBtn" data-key="left">←</button>
                <button class="controlBtn" data-key="right">→</button>
                <button class="controlBtn" data-key="down">↓</button>
            </div>
        </div>
        <div class="fireButtons">
            <button class="fireBtn" data-key="bomb">DROP<br>BOMB</button>
        </div>
    </div>
    <div id="startScreen">
        <h1>DRONE STRIKE</h1>
        <button class="btn" onclick="startGame()">START MISSION</button>
        <div class="instructions">
            <div>← → or A D – MOVE DRONE</div>
            <div>SPACE or X – DROP BOMB</div>
            <div>Destroy ground targets. Avoid missing too many.</div>
        </div>
    </div>
    <div id="gameOverScreen" class="hidden">
        <h1>MISSION FAILED</h1>
        <div style="font-size:32px;margin:20px;">FINAL SCORE: <span id="finalScore">0</span></div>
        <button class="btn" onclick="startGame()">RETRY</button>
    </div>
</div>
<script>
/* ---------- GLOBALS ---------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let gameState = 'start';
let score = 0, lives = 3;
const player = {x: canvas.width/2, y: 120, width: 44, height: 44, speed: 5};
let keys = {}, bombs = [], groundEnemies = [], explosions = [], clouds = [];
let bombCooldown = 0;
let missCount = 0;
const MAX_MISSES = 5;
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
if (isMobile) document.getElementById('mobileControls').classList.add('active');

/* ---------- CLOUDS (foreground) ---------- */
for(let i=0;i<25;i++) clouds.push({
    x: Math.random()*canvas.width,
    y: Math.random()*180,
    size: Math.random()*50+30,
    speed: Math.random()*0.3+0.1
});

/* ---------- INPUT ---------- */
document.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
    if ((e.key===' '||e.key.toLowerCase()==='x') && gameState==='playing' && bombCooldown<=0) dropBomb();
});
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
function touchStart(e){e.preventDefault(); const k=this.dataset.key; if(k==='bomb')dropBomb(); else keys[k]=true;}
function touchEnd(e){e.preventDefault(); const k=this.dataset.key; if(k!=='bomb') keys[k]=false;}
document.querySelectorAll('.controlBtn,.fireBtn').forEach(b=>{b.addEventListener('touchstart',touchStart);b.addEventListener('touchend',touchEnd);});

/* ---------- GAME FLOW ---------- */
function startGame(){
    gameState='playing'; score=0; lives=3; missCount=0;
    player.x=canvas.width/2; bombs=[]; groundEnemies=[]; explosions=[]; bombCooldown=0;
    document.getElementById('startScreen').classList.add('hidden');
    document.getElementById('gameOverScreen').classList.add('hidden');
    updateUI();
    requestAnimationFrame(gameLoop);
}
function gameOver(){
    gameState='gameover';
    document.getElementById('finalScore').textContent=score;
    document.getElementById('gameOverScreen').classList.remove('hidden');
}
function updateUI(){
    document.getElementById('score').textContent=score;
    document.getElementById('lives').textContent=lives;
}

/* ---------- PLAYER (DRONE – foreground) ---------- */
function updatePlayer(){
    if ((keys['arrowleft']||keys['a']||keys['left']) && player.x>30) player.x-=player.speed;
    if ((keys['arrowright']||keys['d']||keys['right']) && player.x<canvas.width-30) player.x+=player.speed;
    if ((keys['arrowup']||keys['w']||keys['up']) && player.y>80) player.y-=player.speed;
    if ((keys['arrowdown']||keys['s']||keys['down']) && player.y<200) player.y+=player.speed;
    if (bombCooldown>0) bombCooldown--;
}

/* ---------- BOMB DROP (perspective) ---------- */
function dropBomb(){
    bombs.push({
        x: player.x,
        y: player.y,
        targetY: canvas.height-80,               // ground plane
        speed: 8,                                 // pixels per frame toward ground
        scale: 1,
        life: 300
    });
    bombCooldown = 12;
}
function updateBombs(){
    const newB = [];
    for(const b of bombs){
        // move toward ground
        const dy = b.targetY - b.y;
        if (Math.abs(dy) < b.speed) {
            b.y = b.targetY;
        } else {
            b.y += b.speed * Math.sign(dy);
        }
        // perspective scaling (larger when farther away)
        const depth = (b.y - 120) / (canvas.height-200);
        b.scale = 0.3 + depth*0.9;   // 0.3 at drone, ~1.2 at ground

        b.life--;
        let hit = false;
        for(let j=groundEnemies.length-1;j>=0;j--){
            const e = groundEnemies[j];
            if(e.destroyed) continue;
            const dist = Math.hypot(b.x - e.x, b.y - e.y);
            if(dist < 30*b.scale){
                e.hp--;
                if(e.hp<=0){
                    e.destroyed=true;
                    createExplosion(e.x,e.y,70);
                    score += e.type==='bunker'?200:e.type==='turret'?150:300;
                    updateUI();
                }
                hit=true;
                break;
            }
        }
        if(!hit && b.life>0 && b.y < canvas.height-50) newB.push(b);
        else if(!hit && b.y >= canvas.height-80){
            missCount++;
            if(missCount>=MAX_MISSES){
                lives--; missCount=0; updateUI();
                if(lives<=0) gameOver();
            }
        }
    }
    bombs = newB;
}

/* ---------- TARGET RETICLE (impact predictor) ---------- */
let targetReticle = null;
function updateTargetReticle(){
    if(bombCooldown>0 || bombs.length>0){ targetReticle=null; return; }
    const impactY = canvas.height-80;
    const impactX = player.x;
    let closest=null, minDist=Infinity;
    for(const e of groundEnemies){
        if(e.destroyed) continue;
        const d = Math.hypot(impactX-e.x, impactY-e.y);
        if(d<minDist){ minDist=d; closest=e; }
    }
    targetReticle = closest ? {x:closest.x, y:closest.y, predX:impactX, predY:impactY}
                            : {x:impactX, y:impactY, predX:impactX, predY:impactY};
}

/* ---------- GROUND ENEMIES (background, scroll toward player) ---------- */
function spawnGroundEnemy(){
    const types = ['bunker','turret','depot'];
    const type = types[Math.floor(Math.random()*types.length)];
    groundEnemies.push({
        x: Math.random()*(canvas.width-80)+40,
        y: canvas.height+80,                     // start below screen
        width: type==='bunker'?55:type==='turret'?45:50,
        height: 40,
        type,
        hp: type==='bunker'?3:type==='turret'?2:1,
        destroyed:false,
        speed: 1.6
    });
}
function updateGroundEnemies(){
    const newE = [];
    for(const e of groundEnemies){
        e.y -= e.speed;                          // move up (toward player)
        if(e.y > -100) newE.push(e);
    }
    groundEnemies = newE;
}

/* ---------- EXPLOSIONS ---------- */
function createExplosion(x,y,size=50){
    explosions.push({x,y,size,life:25,maxLife:25});
}
function updateExplosions(){
    const newE = [];
    for(const e of explosions){
        e.life--;
        if(e.life>0) newE.push(e);
    }
    explosions = newE;
}

/* ---------- CLOUDS (foreground) ---------- */
function updateClouds(){
    for(const c of clouds){
        c.x += c.speed;
        if(c.x > canvas.width+100) c.x = -100;
    }
}

/* ---------- DRAWING ---------- */
function drawBackground(){
    // Sky
    const grad = ctx.createLinearGradient(0,0,0,canvas.height);
    grad.addColorStop(0,'#87CEEB');
    grad.addColorStop(1,'#98D8C8');
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Ground (far away)
    ctx.fillStyle = '#8B7355';
    ctx.fillRect(0,canvas.height-100,canvas.width,100);
    ctx.fillStyle = '#228B22';
    ctx.fillRect(0,canvas.height-100,canvas.width,20);
}
function drawClouds(){
    ctx.fillStyle = '#fff';
    for(const c of clouds){
        ctx.globalAlpha = 0.85;
        ctx.beginPath();
        ctx.arc(c.x,c.y,c.size*0.4,0,Math.PI*2);
        ctx.arc(c.x+c.size*0.3,c.y,c.size*0.5,0,Math.PI*2);
        ctx.arc(c.x-c.size*0.3,c.y,c.size*0.5,0,Math.PI*2);
        ctx.fill();
    }
    ctx.globalAlpha = 1;
}
function drawPlayer(){
    ctx.save();
    ctx.translate(player.x,player.y);
    // Drone body
    ctx.fillStyle = '#444';
    ctx.fillRect(-22,-22,44,44);
    ctx.fillRect(-12,-30,24,12);
    // Propellers (simple lines)
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 3;
    for(let i=0;i<4;i++){
        const px = [-16,16,-16,16][i];
        const py = [-12,-12,12,12][i];
        ctx.beginPath();
        ctx.moveTo(px-10,py);
        ctx.lineTo(px+10,py);
        ctx.stroke();
    }
    // Camera dot
    ctx.fillStyle = '#f00';
    ctx.beginPath(); ctx.arc(0,0,4,0,Math.PI*2); ctx.fill();
    ctx.restore();
}
function drawBombs(){
    for(const b of bombs){
        ctx.save();
        const depth = (b.y-120)/(canvas.height-200);
        const scale = 0.3 + depth*0.9;
        ctx.translate(b.x,b.y);
        ctx.scale(scale,scale);
        // bomb shape
        ctx.fillStyle = '#333';
        ctx.fillRect(-4,-7,8,14);
        ctx.fillStyle = '#f80';
        ctx.fillRect(-3,4,6,6);
        ctx.restore();
    }
}
function drawGroundEnemies(){
    for(const e of groundEnemies){
        if(e.destroyed) continue;
        const depth = (e.y-120)/(canvas.height-200);
        const scale = 0.5 + depth*0.7;   // smaller when farther
        ctx.save();
        ctx.translate(e.x,e.y);
        ctx.scale(scale,scale);
        if(e.type==='bunker'){
            ctx.fillStyle='#555'; ctx.fillRect(-27,-15,54,30);
            ctx.fillStyle='#333'; ctx.fillRect(-22,-10,44,20);
            ctx.fillStyle='#f00'; ctx.fillRect(-5,-22,10,12);
        }else if(e.type==='turret'){
            ctx.fillStyle='#666'; ctx.fillRect(-16,-10,32,20);
            ctx.fillStyle='#444'; ctx.fillRect(-5,-22,10,16);
            ctx.fillStyle='#f00';
            ctx.beginPath(); ctx.arc(0,-14,6,0,Math.PI*2); ctx.fill();
        }else{ // depot
            ctx.fillStyle='#8B4513'; ctx.fillRect(-24,-18,48,36);
            ctx.fillStyle='#FFD700';
            ctx.fillRect(-19,-14,12,12);
            ctx.fillRect(-3,-14,12,12);
            ctx.fillRect(13,-14,12,12);
        }
        ctx.restore();
    }
}
function drawExplosions(){
    for(const e of explosions){
        const a = e.life/e.maxLife;
        const s = e.size*(1+(1-a)*0.8);
        ctx.save();
        ctx.globalAlpha = a;
        ctx.translate(e.x,e.y);
        ctx.fillStyle='#ff9500';
        ctx.beginPath(); ctx.arc(0,0,s*0.5,0,Math.PI*2); ctx.fill();
        ctx.fillStyle='#ff0000';
        ctx.beginPath(); ctx.arc(0,0,s*0.8,0,Math.PI*2); ctx.fill();
        ctx.restore();
    }
    ctx.globalAlpha=1;
}
function drawTargetReticle(){
    if(!targetReticle) return;
    const {predX,predY} = targetReticle;
    ctx.strokeStyle='#ff0000';
    ctx.lineWidth=2;
    ctx.setLineDash([8,8]);
    ctx.beginPath();
    ctx.arc(predX,predY,35,0,Math.PI*2);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.strokeStyle='#ffff00';
    ctx.beginPath();
    ctx.moveTo(predX-40,predY); ctx.lineTo(predX-20,predY);
    ctx.moveTo(predX+20,predY); ctx.lineTo(predX+40,predY);
    ctx.moveTo(predX,predY-40); ctx.lineTo(predX,predY-20);
    ctx.moveTo(predX,predY+20); ctx.lineTo(predX,predY+40);
    ctx.stroke();
}

/* ---------- MAIN LOOP ---------- */
let enemySpawnTimer = 0;
function gameLoop(){
    if(gameState!=='playing') return;
    drawBackground();
    updateClouds();
    drawClouds();
    updatePlayer();
    updateBombs();
    updateGroundEnemies();
    updateExplosions();
    updateTargetReticle();

    // spawn enemies
    if(++enemySpawnTimer>85){
        spawnGroundEnemy();
        enemySpawnTimer=0;
    }

    drawGroundEnemies();
    drawTargetReticle();
    drawBombs();
    drawExplosions();
    drawPlayer();

    requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
