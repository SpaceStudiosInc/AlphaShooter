<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<title>Space Bomber</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {background:#000;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:'Courier New',monospace;color:#fff;overflow:hidden;}
    #gameContainer {position:relative;max-width:100vw;max-height:100vh;}
    canvas {border:3px solid #333;background:#000;display:block;max-width:100%;max-height:100vh;}
    #ui {position:absolute;top:10px;left:10px;font-size:18px;color:#0f0;text-shadow:2px 2px 4px #000;z-index:10;}
    #startScreen,#gameOverScreen {position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,0.9);z-index:20;}
    .hidden {display:none !important;}
    h1 {font-size:48px;color:#0ff;margin-bottom:20px;text-shadow:0 0 20px #0ff;}
    .btn {padding:15px 40px;font-size:20px;background:#0f0;border:none;color:#000;cursor:pointer;font-weight:bold;margin:10px;transition:all .3s;touch-action:manipulation;}
    .btn:hover {background:#0ff;transform:scale(1.1);}
    .instructions {margin-top:30px;text-align:center;color:#aaa;font-size:14px;}
    .instructions div {margin:5px 0;}
    #mobileControls {position:absolute;bottom:20px;left:0;right:0;display:none;justify-content:space-between;padding:0 20px;z-index:15;}
    #mobileControls.active {display:flex;}
    .controlGroup {display:flex;flex-direction:column;gap:10px;}
    .dpad {display:grid;grid-template-columns:60px 60px 60px;grid-template-rows:60px 60px 60px;gap:5px;}
    .controlBtn {background:rgba(0,255,255,.3);border:2px solid #0ff;color:#0ff;font-size:24px;font-weight:bold;border-radius:10px;touch-action:manipulation;user-select:none;}
    .controlBtn:active {background:rgba(0,255,255,.6);}
    .dpad .controlBtn:nth-child(1){grid-column:2;grid-row:1;}
    .dpad .controlBtn:nth-child(2){grid-column:1;grid-row:2;}
    .dpad .controlBtn:nth-child(3){grid-column:3;grid-row:2;}
    .dpad .controlBtn:nth-child(4){grid-column:2;grid-row:3;}
    .fireButtons {display:flex;flex-direction:column;gap:10px;}
    .fireBtn {width:80px;height:80px;background:rgba(255,0,255,.3);border:3px solid #f0f;color:#f0f;font-size:16px;font-weight:bold;border-radius:50%;touch-action:manipulation;user-select:none;}
    .fireBtn:active {background:rgba(255,0,255,.6);}
    @media (max-width:768px){
        h1{font-size:32px;}
        .instructions{font-size:12px;}
    }
</style>
</head>
<body>
<div id="gameContainer">
    <canvas id="gameCanvas" width="600" height="800"></canvas>

    <div id="ui">
        <div>SCORE: <span id="score">0</span></div>
        <div>LIVES: <span id="lives">3</span></div>
    </div>

    <div id="mobileControls">
        <div class="controlGroup">
            <div class="dpad">
                <button class="controlBtn" data-key="up">Up</button>
                <button class="controlBtn" data-key="left">Left</button>
                <button class="controlBtn" data-key="right">Right</button>
                <button class="controlBtn" data-key="down">Down</button>
            </div>
        </div>
        <div class="fireButtons">
            <button class="fireBtn" data-key="fire">AIR<br>FIRE</button>
            <button class="fireBtn" data-key="bomb">BOMB</button>
        </div>
    </div>

    <div id="startScreen">
        <h1>SPACE XEVIOUS</h1>
        <button class="btn" onclick="startGame()">START GAME</button>
        <div class="instructions">
            <div>Left Arrow Right Arrow MOVE LEFT/RIGHT</div>
            <div>Up Arrow Down Arrow MOVE UP/DOWN</div>
            <div>Z or SPACE – AIR BLASTER</div>
            <div>X – GROUND BOMB</div>
            <div></div>
            <div>Destroy aerial enemies with blaster</div>
            <div>Target ground installations with bombs</div>
        </div>
    </div>

    <div id="gameOverScreen" class="hidden">
        <h1>GAME OVER</h1>
        <div style="font-size:32px;margin:20px;">FINAL SCORE: <span id="finalScore">0</span></div>
        <button class="btn" onclick="startGame()">PLAY AGAIN</button>
    </div>
</div>

<script>
/* ----------  GLOBALS ---------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let gameState = 'start';
let score = 0, lives = 3, scrollY = 0;
const player = {x:300, y:600, width:24, height:24, speed:5};
let keys = {}, bullets = [], bombs = [], airEnemies = [], groundEnemies = [], explosions = [], stars = [];
let targetReticle = null;
let bulletCooldown = 0, bombCooldown = 0;
let enemySpawnTimer = 0, groundSpawnTimer = 0;
let invulnerable = 0;
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
if (isMobile) document.getElementById('mobileControls').classList.add('active');

/* ----------  INPUT ---------- */
document.addEventListener('keydown', e => {
    keys[e.key] = true;
    if ((e.key === 'z' || e.key === 'Z' || e.key === ' ') && gameState === 'playing' && bulletCooldown <= 0) shootBullet();
    if ((e.key === 'x' || e.key === 'X') && gameState === 'playing' && bombCooldown <= 0) dropBomb();
});
document.addEventListener('keyup', e => keys[e.key] = false);

function handleTouchStart(e){e.preventDefault(); const k=this.dataset.key; if(k==='fire') shootBullet(); else if(k==='bomb') dropBomb(); else keys[k]=true;}
function handleTouchEnd(e){e.preventDefault(); const k=this.dataset.key; if(k!=='fire' && k!=='bomb') keys[k]=false;}
document.querySelectorAll('.controlBtn,.fireBtn').forEach(b=>{b.addEventListener('touchstart',handleTouchStart);b.addEventListener('touchend',handleTouchEnd);});

/* ----------  STARS ---------- */
for(let i=0;i<100;i++) stars.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, size:Math.random()*2+0.5, speed:Math.random()*0.5+0.5});

/* ----------  GAME FLOW ---------- */
function startGame(){
    gameState='playing'; score=0; lives=3; scrollY=0;
    player.x=300; player.y=600;
    bullets=[]; bombs=[]; airEnemies=[]; groundEnemies=[]; explosions=[]; targetReticle=null;
    invulnerable=120;
    document.getElementById('startScreen').classList.add('hidden');
    document.getElementById('gameOverScreen').classList.add('hidden');
    updateUI();
    requestAnimationFrame(gameLoop);
}
function gameOver(){
    gameState='gameover';
    document.getElementById('finalScore').textContent=score;
    document.getElementById('gameOverScreen').classList.remove('hidden');
}
function updateUI(){document.getElementById('score').textContent=score; document.getElementById('lives').textContent=lives;}

/* ----------  PLAYER ---------- */
function updatePlayer(){
    if ((keys['ArrowLeft']||keys['left']) && player.x>20) player.x-=player.speed;
    if ((keys['ArrowRight']||keys['right']) && player.x<canvas.width-20) player.x+=player.speed;
    if ((keys['ArrowUp']||keys['up']) && player.y>100) player.y-=player.speed;
    if ((keys['ArrowDown']||keys['down']) && player.y<canvas.height-50) player.y+=player.speed;
    if (invulnerable>0) invulnerable--;
    if (bulletCooldown>0) bulletCooldown--;
    if (bombCooldown>0) bombCooldown--;
}

/* ----------  PROJECTILES ---------- */
function shootBullet(){
    bullets.push({x:player.x, y:player.y-10, width:4, height:12, speed:12});
    bulletCooldown=8;
}
function dropBomb(){
    bombs.push({x:player.x, y:player.y, targetY:player.y+200, width:8, height:8, speed:6, phase:0});
    bombCooldown=20;
}
function updateBullets(){
    const newB = [];
    for(const b of bullets){
        b.y -= b.speed;
        if(b.y<-20) continue;
        let hit=false;
        for(let j=airEnemies.length-1;j>=0;j--){
            const e=airEnemies[j];
            if(b.x>e.x-e.width/2 && b.x<e.x+e.width/2 && b.y>e.y-e.height/2 && b.y<e.y+e.height/2){
                e.hp--;
                if(e.hp<=0){
                    createExplosion(e.x,e.y,35);
                    airEnemies.splice(j,1);
                    score+=e.type==='drone'?100:200;
                    updateUI();
                }
                hit=true; break;
            }
        }
        if(!hit) newB.push(b);
    }
    bullets=newB;
}
function updateBombs(){
    const newB = [];
    for(const b of bombs){
        b.y+=b.speed; b.phase+=0.3;
        if(b.y>canvas.height) continue;
        let hit=false;
        for(let j=groundEnemies.length-1;j>=0;j--){
            const e=groundEnemies[j];
            if(!e.destroyed && Math.abs(b.x-e.x)<30 && Math.abs(b.y-e.y)<30){
                e.hp--;
                if(e.hp<=0){
                    e.destroyed=true;
                    createExplosion(e.x,e.y,50);
                    score+=e.type==='turret'?150:300;
                    updateUI();
                }
                hit=true; break;
            }
        }
        if(!hit) newB.push(b);
    }
    bombs=newB;
}

/* ----------  ENEMIES ---------- */
function spawnAirEnemy(){
    const type = Math.random()<0.7?'drone':'fighter';
    airEnemies.push({
        x:Math.random()*(canvas.width-40)+20, y:-30,
        width:type==='drone'?20:28, height:type==='drone'?20:28,
        speed:type==='drone'?2:3, type, hp:type==='drone'?1:2,
        pattern:Math.random()<0.5?'straight':'sine', phase:Math.random()*Math.PI*2
    });
}
function spawnGroundEnemy(){
    groundEnemies.push({
        x:Math.random()*(canvas.width-50)+25, y:-30,
        width:40, height:40,
        type:Math.random()<0.6?'turret':'base',
        hp:Math.random()<0.6?2:3, destroyed:false
    });
}
function updateAirEnemies(){
    const newE = [];
    for(const e of airEnemies){
        e.y+=e.speed;
        if(e.pattern==='sine'){ e.phase+=0.08; e.x+=Math.sin(e.phase)*2; }
        if(invulnerable<=0 && Math.abs(e.x-player.x)<(e.width+player.width)/2 && Math.abs(e.y-player.y)<(e.height+player.height)/2){
            createExplosion(player.x,player.y,50);
            createExplosion(e.x,e.y,35);
            lives--; invulnerable=120; updateUI();
            if(lives<=0) gameOver();
            continue;
        }
        if(e.y<canvas.height+50) newE.push(e);
    }
    airEnemies=newE;
}
function updateGroundEnemies(){
    const newE = [];
    for(const e of groundEnemies) { e.y+=1.5; if(e.y<canvas.height+50) newE.push(e); }
    groundEnemies=newE;
}

/* ----------  EXPLOSIONS & STARS ---------- */
function createExplosion(x,y,size=30){
    explosions.push({x,y,size,life:20,maxLife:20});
}
function updateExplosions(){
    const newE = [];
    for(const e of explosions){ e.life--; if(e.life>0) newE.push(e); }
    explosions=newE;
}
function updateStars(){
    for(const s of stars){
        s.y+=s.speed+1.5;
        if(s.y>canvas.height){ s.y=0; s.x=Math.random()*canvas.width; }
    }
}

/* ----------  TARGET RETICLE ---------- */
function updateTargetReticle(){
    const reticleY = player.y+200;
    let closest=null, minDist=50;
    for(const e of groundEnemies){
        if(e.destroyed) continue;
        const d = Math.hypot(e.x-player.x, e.y-reticleY);
        if(d<minDist){ minDist=d; closest=e; }
    }
    targetReticle = closest?{x:closest.x, y:closest.y}:null;
}

/* ----------  DRAWING ---------- */
function drawPlayer(){
    if(invulnerable>0 && Math.floor(invulnerable/5)%2===0) return;
    ctx.save(); ctx.translate(player.x,player.y);
    ctx.fillStyle='#0ff';
    ctx.beginPath(); ctx.moveTo(0,-12); ctx.lineTo(-10,12); ctx.lineTo(0,8); ctx.lineTo(10,12); ctx.closePath(); ctx.fill();
    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(0,0,4,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#08f'; ctx.fillRect(-12,4,4,8); ctx.fillRect(8,4,4,8);
    ctx.restore();
}
function drawBullets(){
    ctx.fillStyle='#ff0';
    for(const b of bullets) ctx.fillRect(b.x-2,b.y-6,4,12);
}
function drawBombs(){
    for(const b of bombs){
        ctx.save(); ctx.translate(b.x,b.y); ctx.rotate(b.phase);
        ctx.strokeStyle='#f0f'; ctx.lineWidth=2;
        ctx.beginPath(); ctx.arc(0,0,6,0,Math.PI*2); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(-6,0); ctx.lineTo(6,0); ctx.moveTo(0,-6); ctx.lineTo(0,6); ctx.stroke();
        ctx.restore();
    }
}
function drawAirEnemies(){
    for(const e of airEnemies){
        ctx.save(); ctx.translate(e.x,e.y);
        if(e.type==='drone'){
            ctx.fillStyle=e.hp>1?'#f00':'#f88';
            ctx.beginPath(); ctx.arc(0,0,10,0,Math.PI*2); ctx.fill();
            ctx.fillStyle='#800'; ctx.fillRect(-8,-2,16,4); ctx.fillRect(-2,-8,4,16);
        }else{
            ctx.fillStyle=e.hp>1?'#f60':'#fa0';
            ctx.beginPath(); ctx.moveTo(0,-14); ctx.lineTo(-12,8); ctx.lineTo(0,4); ctx.lineTo(12,8); ctx.closePath(); ctx.fill();
            ctx.fillStyle='#f00'; ctx.fillRect(-14,6,5,8); ctx.fillRect(9,6,5,8);
        }
        ctx.restore();
    }
}
function drawGroundEnemies(){
    for(const e of groundEnemies){
        if(e.destroyed) continue;
        ctx.save(); ctx.translate(e.x,e.y);
        if(e.type==='turret'){
            ctx.fillStyle='#888'; ctx.fillRect(-15,-5,30,10); ctx.fillRect(-8,-15,16,10);
            ctx.fillStyle='#f44'; ctx.beginPath(); ctx.arc(0,-10,6,0,Math.PI*2); ctx.fill();
        }else{
            ctx.fillStyle='#666'; ctx.fillRect(-20,-10,40,20);
            ctx.fillStyle='#f44'; ctx.fillRect(-15,-5,10,10); ctx.fillRect(5,-5,10,10);
            ctx.fillStyle='#aaa'; ctx.fillRect(-5,-15,10,10);
        }
        ctx.restore();
    }
}
function drawExplosions(){
    for(const e of explosions){
        const a = e.life/e.maxLife;
        const s = e.size*(1+(1-a)*0.5);
        ctx.save(); ctx.globalAlpha=a; ctx.translate(e.x,e.y);
        ctx.fillStyle='#ff0'; ctx.beginPath(); ctx.arc(0,0,s*0.4,0,Math.PI*2); ctx.fill();
        ctx.fillStyle='#f80'; ctx.beginPath(); ctx.arc(0,0,s*0.7,0,Math.PI*2); ctx.fill();
        ctx.fillStyle='#f00'; ctx.beginPath(); ctx.arc(0,0,s,0,Math.PI*2); ctx.fill();
        ctx.restore();
    }
}
function drawStars(){
    ctx.fillStyle='#fff';
    for(const s of stars){
        ctx.globalAlpha=s.size/2;
        ctx.fillRect(s.x,s.y,s.size,s.size);
    }
    ctx.globalAlpha=1;
}
function drawTargetReticle(){
    if(!targetReticle) return;
    ctx.strokeStyle='#f0f'; ctx.lineWidth=2; ctx.setLineDash([5,5]);
    ctx.beginPath(); ctx.arc(targetReticle.x,targetReticle.y,25,0,Math.PI*2); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(targetReticle.x-30,targetReticle.y); ctx.lineTo(targetReticle.x-20,targetReticle.y);
    ctx.moveTo(targetReticle.x+20,targetReticle.y); ctx.lineTo(targetReticle.x+30,targetReticle.y);
    ctx.moveTo(targetReticle.x,targetReticle.y-30); ctx.lineTo(targetReticle.x,targetReticle.y-20);
    ctx.moveTo(targetReticle.x,targetReticle.y+20); ctx.lineTo(targetReticle.x,targetReticle.y+30);
    ctx.stroke(); ctx.setLineDash([]);
}

/* ----------  MAIN LOOP ---------- */
function gameLoop(){
    if(gameState!=='playing') return;
    ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height);

    updateStars(); drawStars();
    updatePlayer();
    updateBullets(); updateBombs();
    updateAirEnemies(); updateGroundEnemies();
    updateExplosions(); updateTargetReticle();

    // spawn
    if(++enemySpawnTimer>60){ spawnAirEnemy(); enemySpawnTimer=0; }
    if(++groundSpawnTimer>120){ spawnGroundEnemy(); groundSpawnTimer=0; }

    drawGroundEnemies(); drawTargetReticle(); drawBombs(); drawAirEnemies();
    drawExplosions(); drawBullets(); drawPlayer();

    requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
