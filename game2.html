<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drone Strike</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{background:#222;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:'Courier New',monospace;color:#fff;overflow:hidden;}
    #gameContainer{position:relative;max-width:100vw;max-height:100vh;}
    canvas{border:3px solid #444;background:#87CEEB;display:block;max-width:100%;max-height:100vh;}
    #ui{position:absolute;top:10px;left:10px;font-size:18px;color:#222;text-shadow:1px 1px 2px #fff;z-index:10;}
    #startScreen,#gameOverScreen{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,0.9);z-index:20;}
    .hidden{display:none !important;}
    h1{font-size:48px;color:#ffcc00;margin-bottom:20px;text-shadow:0 0 15px #ff9900;}
    .btn{padding:15px 40px;font-size:20px;background:#ffcc00;border:none;color:#000;cursor:pointer;font-weight:bold;margin:10px;transition:all .3s;touch-action:manipulation;}
    .btn:hover{background:#ffeb3b;transform:scale(1.1);}
    .instructions{margin-top:30px;text-align:center;color:#ddd;font-size:14px;}
    .instructions div{margin:5px 0;}
    #mobileControls{position:absolute;bottom:20px;left:0;right:0;display:none;justify-content:space-between;padding:0 20px;z-index:15;}
    #mobileControls.active{display:flex;}
    .controlGroup{display:flex;flex-direction:column;gap:10px;}
    .dpad{display:grid;grid-template-columns:60px 60px 60px;grid-template-rows:60px 60px 60px;gap:5px;}
    .controlBtn{background:rgba(255,255,255,.3);border:2px solid #fff;color:#fff;font-size:24px;font-weight:bold;border-radius:10px;touch-action:manipulation;user-select:none;}
    .controlBtn:active{background:rgba(255,255,255,.6);}
    .dpad .controlBtn:nth-child(1){grid-column:2;grid-row:1;}
    .dpad .controlBtn:nth-child(2){grid-column:1;grid-row:2;}
    .dpad .controlBtn:nth-child(3){grid-column:3;grid-row:2;}
    .dpad .controlBtn:nth-child(4){grid-column:2;grid-row:3;}
    .fireButtons{display:flex;flex-direction:column;gap:10px;}
    .fireBtn{width:90px;height:90px;background:rgba(255,0,0,.4);border:3px solid #f00;color:#fff;font-size:16px;font-weight:bold;border-radius:50%;touch-action:manipulation;user-select:none;display:flex;align-items:center;justify-content:center;text-align:center;}
    .fireBtn:active{background:rgba(255,0,0,.8);}
    @media(max-width:768px){h1{font-size:32px;}.instructions{font-size:12px;}}
</style>
</head>
<body>
<div id="gameContainer">
    <canvas id="gameCanvas" width="600" height="800"></canvas>
    <div id="ui">
        <div>SCORE: <span id="score">0</span></div>
        <div>LIVES: <span id="lives">3</span></div>
    </div>
    <div id="mobileControls">
        <div class="controlGroup">
            <div class="dpad">
                <button class="controlBtn" data-key="left">←</button>
                <button class="controlBtn" data-key="up">↑</button>
                <button class="controlBtn" data-key="down">↓</button>
                <button class="controlBtn" data-key="right">→</button>
            </div>
        </div>
        <div class="fireButtons">
            <button class="fireBtn" data-key="bomb">DROP<br>BOMB</button>
        </div>
    </div>
    <div id="startScreen">
        <h1>DRONE STRIKE</h1>
        <button class="btn" onclick="startGame()">START MISSION</button>
        <div class="instructions">
            <div>← → ↑ ↓ or WASD – MOVE DRONE</div>
            <div>SPACE or X – DROP BOMB</div>
            <div>Target enemies scrolling from top. 1 second delayed strike!</div>
        </div>
    </div>
    <div id="gameOverScreen" class="hidden">
        <h1>MISSION FAILED</h1>
        <div style="font-size:32px;margin:20px;">FINAL SCORE: <span id="finalScore">0</span></div>
        <button class="btn" onclick="startGame()">RETRY</button>
    </div>
</div>
<script>
/* ---------- GLOBALS ---------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let gameState = 'start';
let score = 0, lives = 3;
const player = { x: canvas.width / 2, y: 120, width: 44, height: 44, speed: 5 };
let keys = {}, bombs = [], groundEnemies = [], explosions = [];
let bombCooldown = 0;
let missCount = 0;
const MAX_MISSES = 8;
const GROUND_Y = canvas.height - 60;  // explosion line
let scrollY = 0;                      // background scroll
const SCROLL_SPEED = 2.5;
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
if (isMobile) document.getElementById('mobileControls').classList.add('active');

/* ---------- INPUT ---------- */
document.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
    if ((e.key === ' ' || e.key.toLowerCase() === 'x') && gameState === 'playing' && bombCooldown <= 0) dropBomb();
});
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
function touchStart(e) { e.preventDefault(); const k = this.dataset.key; if (k === 'bomb') dropBomb(); else keys[k] = true; }
function touchEnd(e) { e.preventDefault(); const k = this.dataset.key; if (k !== 'bomb') keys[k] = false; }
document.querySelectorAll('.controlBtn,.fireBtn').forEach(b => {
    b.addEventListener('touchstart', touchStart);
    b.addEventListener('touchend', touchEnd);
});

/* ---------- GAME FLOW ---------- */
function startGame() {
    gameState = 'playing'; score = 0; lives = 3; missCount = 0;
    player.x = canvas.width / 2; player.y = 120;
    bombs = []; groundEnemies = []; explosions = []; scrollY = 0;
    bombCooldown = 0;
    document.getElementById('startScreen').classList.add('hidden');
    document.getElementById('gameOverScreen').classList.add('hidden');
    updateUI();
    requestAnimationFrame(gameLoop);
}
function gameOver() {
    gameState = 'gameover';
    document.getElementById('finalScore').textContent = score;
    document.getElementById('gameOverScreen').classList.remove('hidden');
}
function updateUI() {
    document.getElementById('score').textContent = score;
    document.getElementById('lives').textContent = lives;
}

/* ---------- PLAYER (free movement in top half) ---------- */
function updatePlayer() {
    const maxY = canvas.height * 0.45;
    if ((keys['arrowleft'] || keys['a'] || keys['left']) && player.x > 25) player.x -= player.speed;
    if ((keys['arrowright'] || keys['d'] || keys['right']) && player.x < canvas.width - 25) player.x += player.speed;
    if ((keys['arrowup'] || keys['w'] || keys['up']) && player.y > 60) player.y -= player.speed;
    if ((keys['arrowdown'] || keys['s'] || keys['down']) && player.y < maxY) player.y += player.speed;
    if (bombCooldown > 0) bombCooldown--;
}

/* ---------- BOMB (drops, falls, scales down, explodes after 1s) ---------- */
function dropBomb() {
    bombs.push({
        x: player.x,
        startY: player.y + 30,
        life: 60,
        maxLife: 60
    });
    bombCooldown = 18;
}
function updateBombs() {
    const alive = [];
    for (const b of bombs) {
        b.life--;
        if (b.life > 0) {
            const prog = 1 - b.life / b.maxLife;
            b.y = b.startY + prog * (GROUND_Y - b.startY);
            alive.push(b);
        } else {
            createExplosion(b.x, GROUND_Y, 50);
            let hit = false;
            for (let i = groundEnemies.length - 1; i >= 0; i--) {
                const e = groundEnemies[i];
                if (e.destroyed) continue;
                const dist = Math.hypot(b.x - e.x, GROUND_Y - e.y);
                if (dist < 40) {
                    e.hp--;
                    if (e.hp <= 0) {
                        e.destroyed = true;
                        score += e.type === 'tank' ? 300 : e.type === 'building' ? 200 : 150;
                        updateUI();
                    }
                    hit = true;
                    break;
                }
            }
            if (!hit) {
                missCount++;
                if (missCount >= MAX_MISSES) {
                    lives--; missCount = 0; updateUI();
                    if (lives <= 0) gameOver();
                }
            }
        }
    }
    bombs = alive;
}

/* ---------- GROUND ENEMIES (spawn at top, scroll down) ---------- */
function spawnEnemy() {
    const types = ['soldier', 'building', 'tank'];
    const type = types[Math.floor(Math.random() * types.length)];
    groundEnemies.push({
        x: Math.random() * (canvas.width - 60) + 30,
        y: -80,
        type,
        hp: type === 'soldier' ? 1 : type === 'building' ? 4 : 2,
        destroyed: false,
        speed: 1.8 + Math.random() * 1.2
    });
}
function updateEnemies() {
    const alive = [];
    for (const e of groundEnemies) {
        e.y += e.speed + SCROLL_SPEED;
        if (e.y < canvas.height + 100) {
            if (!e.destroyed) alive.push(e);
        }
    }
    groundEnemies = alive;
    if (Math.random() < 0.03) spawnEnemy(); // spawn rate
}

/* ---------- EXPLOSIONS ---------- */
function createExplosion(x, y, size = 50) {
    explosions.push({ x, y, size, life: 25, maxLife: 25 });
}
function updateExplosions() {
    explosions = explosions.filter(e => --e.life > 0);
}

/* ---------- SCROLLING GRASSY FIELD ---------- */
function drawBackground() {
    scrollY += SCROLL_SPEED;
    if (scrollY > 128) scrollY = 0;

    // Sky
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, '#87CEEB');
    grad.addColorStop(0.7, '#98D8C8');
    grad.addColorStop(1, '#228B22');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Scrolling grass tiles
    ctx.fillStyle = '#1a6b1a';
    for (let gy = -128 + (scrollY % 128); gy < canvas.height; gy += 128) {
        for (let gx = 0; gx < canvas.width; gx += 128) {
            ctx.fillRect(gx, gy, 128, 128);
            // grass blades
            ctx.strokeStyle = '#2e8b2e';
            ctx.lineWidth = 1.5;
            for (let i = 0; i < 20; i++) {
                const bx = gx + Math.random() * 128;
                const by = gy + Math.random() * 128;
                ctx.beginPath();
                ctx.moveTo(bx, by);
                ctx.lineTo(bx + Math.random() * 6 - 3, by - Math.random() * 20 - 10);
                ctx.stroke();
            }
        }
    }

    // Ground line (explosion level)
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, GROUND_Y);
    ctx.lineTo(canvas.width, GROUND_Y);
    ctx.stroke();
}

/* ---------- DRAWING ---------- */
function drawPlayer() {
    ctx.save();
    ctx.translate(player.x, player.y);
    // Drone
    ctx.fillStyle = '#444';
    ctx.fillRect(-22, -22, 44, 44);
    ctx.fillStyle = '#666';
    ctx.fillRect(-12, -30, 24, 12);
    // Propellers
    ctx.strokeStyle = '#222';
    ctx.lineWidth = 3;
    for (let i = 0; i < 4; i++) {
        const [px, py] = [[-16, -12], [16, -12], [-16, 12], [16, 12]][i];
        ctx.beginPath();
        ctx.moveTo(px - 14, py);
        ctx.lineTo(px + 14, py);
        ctx.stroke();
    }
    // Camera
    ctx.fillStyle = '#ff0000';
    ctx.beginPath();
    ctx.arc(0, 0, 5, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
}

function drawBombs() {
    for (const b of bombs) {
        const prog = 1 - b.life / b.maxLife;
        const scale = 1 - prog * 0.8; // shrink to 20% at ground
        ctx.save();
        ctx.globalAlpha = 0.9;
        ctx.translate(b.x, b.y);
        ctx.scale(scale, scale);
        // Bomb
        ctx.fillStyle = '#333';
        ctx.fillRect(-5, -10, 10, 20);
        ctx.fillStyle = '#ff6600';
        ctx.fillRect(-4, 8, 8, 6);
        ctx.restore();
    }
}

function drawEnemies() {
    const BASE_SCALE = 0.18;
    for (const e of groundEnemies) {
        if (e.destroyed) continue;
        const distFromTop = e.y;
        const scale = BASE_SCALE + (distFromTop / canvas.height) * 0.15; // grow slightly as they come closer
        ctx.save();
        ctx.translate(e.x, e.y);
        ctx.scale(scale, scale);

        if (e.type === 'soldier') {
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(-8, -25, 16, 25);
            ctx.fillStyle = '#228B22';
            ctx.fillRect(-6, -33, 12, 10);
        } else if (e.type === 'building') {
            ctx.fillStyle = '#555';
            ctx.fillRect(-28, -38, 56, 38);
            ctx.fillStyle = '#444';
            ctx.fillRect(-22, -32, 44, 28);
        } else { // tank
            ctx.fillStyle = '#3a3a3a';
            ctx.fillRect(-25, -20, 50, 20);
            ctx.fillStyle = '#222';
            ctx.fillRect(-18, -28, 36, 14);
            ctx.fillStyle = '#ff0000';
            ctx.beginPath();
            ctx.arc(0, -22, 9, 0, Math.PI * 2);
            ctx.fill();
        }
        ctx.restore();
    }
}

function drawExplosions() {
    for (const e of explosions) {
        const a = e.life / e.maxLife;
        ctx.save();
        ctx.globalAlpha = a;
        ctx.translate(e.x, e.y);
        const size = e.size * (1 + (1 - a) * 0.7);
        ctx.fillStyle = '#ffaa00';
        ctx.beginPath();
        ctx.arc(0, 0, size * 0.6, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#ff4444';
        ctx.beginPath();
        ctx.arc(0, 0, size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
    ctx.globalAlpha = 1;
}

/* ---------- MAIN LOOP ---------- */
function gameLoop() {
    if (gameState !== 'playing') return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    drawBackground();
    updatePlayer();
    updateBombs();
    updateEnemies();
    updateExplosions();

    drawEnemies();
    drawBombs();
    drawExplosions();
    drawPlayer();

    requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
